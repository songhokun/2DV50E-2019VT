%----------------------------------------------------------------------------------------
%
% LaTeX-template for degree projects at LNU, Department of Computer Science
% Last updated by Johan Hagelbäck, Mar 2017
% Linnaeus University
%
% License: Creative Commons BY
%
%----------------------------------------------------------------------------------------

%----------------------------------------------------------------------------------------
%	Settings and configuration
%----------------------------------------------------------------------------------------

\documentclass[a4paper,12pt]{article}

\usepackage[T1]{fontenc}
\usepackage{times}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{dtklogos}
\usepackage{wallpaper}
\usepackage[absolute]{textpos}
\usepackage[top=2cm, bottom=2.5cm, left=3cm, right=3cm]{geometry}
\usepackage{appendix}
\usepackage[nottoc]{tocbibind}
\usepackage[colorlinks=true,
            linkcolor=black,
            urlcolor=blue,
            citecolor=black]{hyperref}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

\usepackage{sectsty}
\sectionfont{\fontsize{14}{15}\selectfont}
\subsectionfont{\fontsize{12}{15}\selectfont}
\subsubsectionfont{\fontsize{12}{15}\selectfont}
\usepackage{placeins}
\usepackage{csquotes} % Used to handle citations
\usepackage{pythonhighlight}

\renewcommand{\thetable}{\arabic{section}.\arabic{table}}  
\renewcommand{\thefigure}{\arabic{section}.\arabic{figure}} 

%----------------------------------------------------------------------------------------
%	
%----------------------------------------------------------------------------------------
\newsavebox{\mybox}
\newlength{\mydepth}
\newlength{\myheight}

\newenvironment{sidebar}%
{\begin{lrbox}{\mybox}\begin{minipage}{\textwidth}}%
{\end{minipage}\end{lrbox}%
 \settodepth{\mydepth}{\usebox{\mybox}}%
 \settoheight{\myheight}{\usebox{\mybox}}%
 \addtolength{\myheight}{\mydepth}%
 \noindent\makebox[0pt]{\hspace{-20pt}\rule[-\mydepth]{1pt}{\myheight}}%
 \usebox{\mybox}}

%----------------------------------------------------------------------------------------
%	Title section
%----------------------------------------------------------------------------------------
\newcommand\BackgroundPic{
    \put(-2,-3){
    \includegraphics[keepaspectratio,scale=0.3]{img/lnu_etch.png} % Background picture
    }
}
\newcommand\BackgroundPicLogo{
    \put(30,740){
    \includegraphics[keepaspectratio,scale=0.10]{img/logo.png} % Logo in upper left corner
    }
}

\title{	
\vspace{-8cm}
\begin{sidebar}
    \vspace{10cm}
    \normalfont \normalsize
    \Huge Bachelor Degree Project \\
    \vspace{-1.3cm}
\end{sidebar}
\vspace{3cm}
\begin{flushleft}
    \huge Effective utilisation of DNS Privacy\\ 
    \it \LARGE - Protection towards pervasive surveillance 
\end{flushleft}
\null
\vfill
\begin{textblock}{6}(10,13)
\begin{flushright}
\begin{minipage}{\textwidth}
\begin{flushleft} \large
\emph{Author:} Songho Lee\\ % Author
\emph{Supervisor:} Ola Flygt\\ % Supervisor
%\emph{Examiner:} Dr.~Mark \textsc{Brown}\\ % Examiner (course manager)
\emph{Semester:} VT 2019\\ % 
\emph{Subject:} Computer Science\\ % Subject area
\end{flushleft}
\end{minipage}
\end{flushright}
\end{textblock}
}

\date{} 

\begin{document}
\pagenumbering{gobble}
\newgeometry{left=5cm}
\AddToShipoutPicture*{\BackgroundPic}
\AddToShipoutPicture*{\BackgroundPicLogo}
\maketitle
\restoregeometry
\clearpage
%----------------------------------------------------------------------------------------
%	Abstract
%----------------------------------------------------------------------------------------
\selectlanguage{english}
\begin{abstract}
\noindent Current usage of the DNS system is the most significant loophole of Internet users' privacy, as all queries and answers for resolving web address are not protected in most cases. % Thesis statement, background description
Lack of confidentiality in the DNS system enables everyone who has control of the path between a user and DNS resolver can collect someone's usage pattern and fingerprint him and filter his access to specific websites. % Motivation
Despite a single solution for addressing privacy risks in all stages of the DNS query process does not exist, the report acquaints several Internet standardisations for DNS privacy that are complementary to the existing DNS system and verifies that implementation of these brings significant enhancement of users' privacy.
%The report explores existing methods to enhance DNS Privacy and sets up a series of experiments to verify implementations of such methods for privacy enhancement. % Description of problem explored
\\\\
\textbf{Keywords: DNS, DNS-over-HTTPS, DNS-over-TLS, DNS Privacy}
\end{abstract}

%----------------------------------------------------------------------------------------
%	Preface
%----------------------------------------------------------------------------------------
%\newpage
%\textbf {\large{Preface}}\\

%\noindent You can have a preface in the report if you want, but it is not necessary. In this you can write more personal reflections on your degree project. In the preface you can also take the opportunity to thank the people who have been particularly helpful during the report writing, for example if you had any contact with a company that helped with the project, people that guided or helped you during the project, or your family and friends that supported you during the project. The preface shall not be longer than half a page.

%----------------------------------------------------------------------------------------
\newpage
\pagenumbering{gobble}
\tableofcontents % Table of contents
\newpage
\pagenumbering{arabic}

%----------------------------------------------------------------------------------------
%
%	Here follows the actual text contents of the report.
%
%----------------------------------------------------------------------------------------

\section{Introduction}
This chapter describes what Doname Name System (DNS) is, and how the legacy design of DNS has become a privacy threat. Before discussing the privacy risks of DNS, the background section introduces relevant structure and mechanisms. Knowledgable readers in DNS and Client subnet function may go to section \ref{problemformulation}.

\subsection{Background}
Digital transformation has brought things used to be done in real life decades ago to the online. At work, people have a video conference call instead of a business trip if not necessary. For shopping goods, people fill in credit card numbers for cross-border payments rather than visiting a bank branch to issue paychecks. In other words, the stage where people work now has been shifted to cyberspace in recent decades, and the Internet has become an essential part of everyday life.

Despite the ubiquitousness of the Internet, users' activities online are collected under pervasive monitoring by different actors.
Pervasive Monitoring means ``widespread attack on privacy \cite{rfc7258}.'' Information collected in such action could lead to a breach of users’ privacy, by re-identifying users based on traffic \cite{herrmann2010analyzing}, or could become aids for launching an active form of attacks, such as masquerade and Denial of Service (DoS).
Unfortunately, insecure architecture of Domain Name System allows the pervasive monitoring, and thus it should be mitigated. Before discussing the privacy problems of DNS, we introduce DNS and its components which are important to adress.

\input{tex/introduction_of_dns.tex}

\subsection{Related work}
The project accredits pioneer research of "DNS Privacy Considerations (RFC 7626) \cite{rfc7626}" which has provided theoretical foundations in analysis of DNS privacy. 
As of 2019, there are number of studies are presented to mitigate privacy issues based on the analysis. These studies are later presented in Chapter 3.

Survey of DNS privacy enhancing methods are presented by P. Werneck and J.H.C. van Heugten. P. Werneck evaluated approaches to improve privacy of DNS and stated limitations of identified approaches \cite{werneck2014dns} in 2014. J. Heugten evaluated exisiting solutions to ehnance DNS Privacy in 2018 in his study \cite{van2018privacy}. As standariseation of DNS-over-HTTPS is recently finalised \cite{rfc8484}, study from van Heugten reflects more recent changes.

\subsection{Problem formulation}\label{problemformulation}
Currently, almost all DNS traffic is sent in clear text \cite{rfc7626} over the UDP protocol \cite{tcp2014analysis}, and it makes DNS queries vulnerable to being hijacked or used to filter users' traffic.
All participants of the DNS query process, as illustrated in Figure \ref{queryprocess}, transmit messages intensively, and these are in plaintext.
It is also noteworthy that all participating authoritative name servers receive the same questions, although it is not necessary for Authoritative servers in higher hierarchies in the process to know all the complete domain address in question.

S. Bortzmeyer has analysed that particular fields in DNS packet \cite{rfc1035} such as Query name (QNAME) and Source IP address reveal ``communication relationships \cite{rfc7626}''.
These series of observations indicate that there are risks of information leakage in following places: (1) tapping on the wire ``between the stub resolvers and the recursive resolvers'', and (2) information leaks in the servers.
The following research questions are formulated having regards to the privacy breaching circumstances.

\begin{table}[h!]
    \begin{tabular} {|p{1.2cm}|p{12.8cm}|} \hline
        \textbf{RQ1} & Which benefits would DNS Privacy bring to different parties? \\ \hline
        \textbf{RQ2} & Which are the use cases that the exisiting DNS Privacy enhancement methods could not address? \\ \hline
        \textbf{RQ3} & Which combination of technologies would be suitable to address the limitation of the current status?\\ \hline
    \end{tabular}
    \caption{Research questions}
\label{researchquestions}
\end{table}

\subsection{Motivation}
Most of the internet activities begin with DNS query, hence DNS is vital. Notwithstanding the importance of DNS, designers of the current DNS protocol have not taken consideration of ``confidentiality of protocol metadata''. Therefore DNS queries reveal communication flows, and this property of DNS protocol is used in different contexts by different actors. Examples of usages are traffic monitoring for network management or limiting the influence of malicious websites by DNS Footprinting of malware \cite{stoner2010dns}, or detecting malware infections \cite{lemos2013got}.

Other exemplary usages of this property of DNS are nation-state surveillance, privacy-unfriendly activities of commercial sectors \cite{weaver2011redirecting}, and illegal actions by criminals. Surveillance affects individuals to possess stress and anxiety \cite{oulasvirta2012long}, and behavioural changes like self-censorship \cite{rfc6973}. RFC 6973 connotes that Privacy harms involve ``harms to financial standing, reputation, solitude, autonomy, and safety \cite{rfc6973}'' of individuals.

S. Farrell et al. state in RFC 7258 that allowing monitoring by benevolent actors and defending privacy against nefarious actors do not hold hand in hand, as the actions required to achieve both, regardless of the motivations, are indistinguishable \cite{rfc7258}.
Disadvantages incurred by lack of DNS privacy significantly overweight advantages, and therefore DNS privacy should be mitigated in any feasible practices.

\subsection{Objectives}
The following objectives are set to answer the research questions and transform the tasks into the smaller pieces, and reasonings on each objectives follow below. Hereafter several words are shorten for the ease of denotation, such as an objective as O and a research question as RQ. Table \ref{objectives} summarises the objectives.
\begin{table}[h!]
    \begin{tabular} {|p{1.2cm}|p{12.8cm}|} \hline
        \textbf{O1} & Analyse different end-users' privacy infringements when not having DNS Privacy\\ \hline
        \textbf{O2} & Explore the state of arts in mitigative methods to enhance DNS Privacy \\ \hline
        \textbf{O3} & Identify areas which the selected methods could not address. \\ \hline
        \textbf{O4} & Analyse alternative approaches to mitigate the current limitations.\\ \hline
    \end{tabular}
    \caption{Objectives}
    \label{objectives}
\end{table}

RQ1 aims to explore benefits by having DNS privacy on different group of people.
As it could be challenging to motivate benefits of having privacy when obscurity prevails, O1 is defined to analyse scenarios when the privacy is violated caused by having insecure or exposed DNS queries.

RQ2 is to find use cases of the exisiting DNS privacy mitigative methods. However, in order to discuss use cases, the state of these methods need to be examined. Therefore, O2 is set to explore the state of arts of the methods and O3 is set to identify areas for  improvements.

At the last, RQ3 attempts to provide useful interventions for the reader of the current report, by finding combination of technologies to overcome the possible limitation of the current practices of DNS Privacy enhancement. For serving the purpose, O4 discuesses possible approaches of using the other technologies.

\subsection{Scope/Limitation}
The project has a focus on improving privacy part, from the security perspectives. In other words, reflected to a Confidentiality, Integrity, Availability(CIA) triad, enhancing Integrity and availability perspectives are less priortised in the current project. Issues and challenges of DNS security as whole may be found in other studies, such as one conducted by Ning Hu et. al.\cite{ning2017dnssecurity}. 

%You cannot solve everything. Here you describe what you do, and what you don't do, in your project. Limitations can for example be that you only compare some frameworks of all frameworks available on the market, that you only suggest an architecture for a specific software product and not a general architecture, or that you only include university students in a study and not a broader population sample.

\subsection{Target group}
The project aims to provide insight on DNS Privacy for Internet users and recursive resolver providers for improving users' privacy.
%Here you outline which target group that might be interested in your work. If you, for example, do a project about software architectures, a target group can be professional developers and architects that work with similar software systems as the system you investigated.

\subsection{Outline}
The report follows in Introduction, Methods, Results, and Discussion(IMRaD) pattern. However, as several scientific methods are chosen, which is described in the next chapter, the result and analysis parts are extended for each chosen scientific method. 

\newpage
\section{Method}\label{Method}
This chapter describes the chosen scientific methods to answer the research questions (Table \ref{researchquestions}) and meet the objectives (Table \ref{objectives}).
The study used scientific methods of systematic literature review and design science. Controlled expeiments were also partially used to verify several statements made in the study. Sections follow to motivate the choice of a scientific method for meeting objectives.
\subsection{Systematic literature review}
A systematic literature review was performed to accomplish O2, which is to study mitigative methods of DNS privacy. Although a recently published article provied an overview of DNS Priavcy enhanceing methods \cite{van2018privacy}, performing systematic literature review was necessary to eradicate possible biases and to minimise opportunities of missing suitable solutions.

To make the review process systematic, a search criterium was set to list articles that cited RFC 7626 from a database Google Scholar, as the analysis had provided a clear insight of DNS privacy issues \cite{rfc7626}, and since around four years had passed after its publication, it was anticipated that fellow researchers have tried to solve or list risks identified in the article.

For inclusion criterium, references of the found articles were further examined, as there were chances of missing to address well-established solutions possibly because the methods had been introcued before publishment of RFC 7626.

Exclusive criteria was set to have the contents of the articles to be relevant to the defined problem. Therefore, any solving other security aspects of DNS, such as availability but not addressing the privacy problems were excluded.

\subsection{Design Science}
Design science ``creates and evaluates Information Technology artifacts to solve identified organisational problems \cite{von2004design}'', and it has a strong relevance in addressing O3 and O4 which are to identify area that studided DNS Privacy methods could not address and analyse alternative approaches to overcome the limitations.

To refine problem statements for the exisiting practice, literature review is made to analyse privacy infringement scenarios on diverse user scenarios, as defined in O1.

\subsection{Controlled Experiment}
Controlled experiment is applied to verify whether suggested design artifact addressed the limitations of current DNS Privacy enhancing methods found in O3 or not. Conducting a controlled experiment fulfills one of the guidelines of design science which requires ``thorough evaluation of the artifact \cite{von2004design}''.

\subsection{Reliability and Validity}
The study is seen to have reliability on the results of the literature review, as the same effect will be derived by performing a search as described in the previous section. As Appendix A includes the source code of the experiment scripts, a similar result is expected to be derived by other researchers as well. 

The project deployed its experiments in a virtualised environment to minimise unforeseen factors that would impact performance measurements.

\subsection{Ethical considerations}
Discussing ethical considerations has less significance in the chosen methods, as no real data of any physical persons is collected without the consent.
However, it can be questioned whether it is adequate to ellaborate privacy breaching scenarios in details to use the information for formulating problems for the design science method.
Despite of the concerns, as the project aims to improve the problematic scenarios of not having sufficient privacy enhancements, describing the problematic situations as-they-are is necessary.

\newpage
\section{Privacy profiles}
\input{tex/privacy.tex}

\newpage
\section{Survey of DNS Privacy enhancing methods}
\input{tex/survey_results.tex}

\newpage
\section{Analysis of DNS Privacy enhancing methods}
\input{tex/survey_analysis.tex}
\newpage

\section{Design Constraints}
Applying channel encipherment methods for securing DNS queries such as using DNS-over-HTTPS or DNS-over-TLS implies that end-client gives trust in the chosen resolver.

Applying traffic anonymisation technologies such as FreeNet \cite{clarke2001freenet} or GNUNet\cite{grothoff2017gnunet} result in having high delays \cite{anonymousoverdns}.
Utilising Distributed Hash Table (DHT) may not necessarily solve the problem of lack of confidentiality. Eventually it has a potential of harming the Integrity of the DNS records.

\subsection{To be or not to be hierarchial}
Refer to the \url{https://blogs.akamai.com/2018/10/architectural-paths-for-evolving-the-dns.html}
\subsubsection{Integrity}
Achieving every aspects of CIA-triad often are not feasible, as enhancing one dimension may interfere the other dimensions.
In this regards, radical protocol design proposals may harm the integrity of the DNS records, as everyone can claim the legitimicy or ownership of the specific domain.
In the decentralised design, interventing the malevoneous records are more challenging than the hierarchial structure of the current DNS system. 

\subsection{Availability}
\newpage
%\section{Design of controlled experiment}
%\input{tex/design_of_protocol_verification.tex}
%\newpage

\section{Results}
This chapter shows the result of verifying DNS Privacy solutions.
\subsection{DNS-over-HTTPS}
Figure \ref{selenium-mode2packets} shows a result of packet captures filtered with DNS (port 53) of a Firefox (66.0.2) simulation with Selenium which network.trr.mode is set as 2 and executed top 10 websites of 'de' domain.

\begin{figure}[h!]
    \begin{center}
    \includegraphics*[width=0.9\columnwidth]{img/selenium-firefox-mode2/wireshark}
    \end{center}
    \caption{Packet captures of Firefox where trust recursive resolver mode is enabled in mode 2}
    \label{selenium-mode2packets}
\end{figure}

%In this chapter you show and describe your results. You shall only show the raw results without any analysis, and you shall not put any conclusions or opinions in the description of the results. Try to be as objective as possible. An example of results from an experiment comparing five sorting algorithms is shown in Table \ref{results} below.\\


\newpage

\section{Analysis}
Results from Figure \ref{selenium-mode2packets} illustrates that none of the DNS queries is encrypted by using DNS-over-HTTPS when traffics are simulated using Selenium. This is suspected that Selenium simulation does utilise Firefox configuration profile that is applied to utilise DoH.

	
	
\newpage
	
\section{Discussion}
\input{tex/discussion.tex}
\newpage
		
\section{Conclusion}
In this chapter you end your report with a conclusion of your findings. What have you shown in your project? Are your results relevant for science, industry or society? How general are your results (i.e. can they be applied to other areas/problems as well)? Also discuss if anything in your project could have been done differently to possibly get better results. 

This chapter is also written in present tense.

\subsection{Future work}
You cannot do everything within the limited scope of a degree project. Here you discuss what you would do if you had continued working on your project. Are there any open questions that you discovered during the project work that you didn't have time to investigate?

\newpage


%----------------------------------------------------------------------------------------
%	References. IEEE style is used.
%
%----------------------------------------------------------------------------------------
\newpage

\hypersetup{urlcolor=black}
\bibliographystyle{IEEEtran}
\bibliography{references}
\newpage
%----------------------------------------------------------------------------------------
%	Appendix
%-----------------------------------------------------------------------------------------
\pagenumbering{Alph}
\setcounter{page}{1} % Reset page numbering for Appendix
\appendix

%\section{Appendix 1}\label{processweblist}
%This section describes the list of websites we simulated. The website list is fetched from Alexa top one million global chart and further classified depends on Top-Level-Domains (TLDs).
%Below is code for a script to convert the Alexa list into a dictionary format.
%\inputpython{../Selenium/process_web_list.py}{1}{30}

%\section{Appendix 2}\label{visitwebsites}
%This section includes a Python script for visiting websites using Selenium.
%Selenium is the web automation test tool\cite{holmes2006automating}, which is typically used to test web applications. However, in our experiments, we utilised Selenium to visit a list of websites for simulating DNS queries. As we intended to use Firefox for DoH simulation, Selenium was incorporated with Firefox Gecko driver to control the web browser. Additionally, a Python script to operate Selenium.

%Python 3.5 and higher, Pip3 is required. It is anticipated that Python packages such as selenium and json are also installed on the system. A Gecko driver needs to be reachable in OS' PATH environment. This code assumes that Firefox browser is installd on the local PC.

%\inputpython{../Selenium/visitwebsites.py}{1}{70}
%\section{Appendix 3}
%Below is code for util.py which is a common base script.
%\inputpython{../Selenium/util.py}{1}{110}
\end{document}
